(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{453:function(t,e,a){"use strict";a.r(e);var n=a(43),s=Object(n.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("A Brief guide on how to cross compile a python embedded C program onto a linux based embedded device.")]),t._v(" "),a("h2",{attrs:{id:"save-effort-by-using-python-library"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#save-effort-by-using-python-library"}},[t._v("#")]),t._v(" Save effort by using python library")]),t._v(" "),a("p",[t._v("Python is somewhat a glue language, it can be easily embedded to almost all the popular languages.\n("),a("em",[a("strong",[t._v("here 'embedded' means calling python runtime inside other languages")])]),t._v(")")]),t._v(" "),a("p",[t._v("Making use of python can save a lot of effort.\nHere I want to take advantage of python's http lib to handle complex web requests in my C application.")]),t._v(" "),a("h2",{attrs:{id:"use-python-on-embedded-devices"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#use-python-on-embedded-devices"}},[t._v("#")]),t._v(" Use python on embedded devices")]),t._v(" "),a("p",[t._v("Not every embedded device can easily run python.\nWhile there are some powerfully and popular embedded devices, "),a("strong",[t._v("Raspberry Pi")]),t._v(" and "),a("strong",[t._v("Beagle Bone")]),t._v(" , which are able to run an entire linux system.\nIt is fairly straightforward to run python on those devices.")]),t._v(" "),a("h2",{attrs:{id:"cross-compile-python-embedded-c-program-on-beagle-bone-green"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cross-compile-python-embedded-c-program-on-beagle-bone-green"}},[t._v("#")]),t._v(" Cross compile python embedded C program on Beagle Bone Green")]),t._v(" "),a("p",[t._v("Here I use an example of Beagle Bone Green which has an ARM architecture and official Debian operating system support.")]),t._v(" "),a("p",[t._v("When cross compiling on host, python libraries and headers on your device need to be accessible.\nHere are some useful tools that can help to locate the libraries:")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://linux.die.net/man/1/pkg-config",target:"_blank",rel:"noopener noreferrer"}},[t._v("pkg-config"),a("OutboundLink")],1),t._v(": run "),a("code",[t._v("pkg-config --libs --cflags python3")]),t._v(" to find all the header files.")]),t._v(" "),a("li",[a("a",{attrs:{href:"http://man7.org/linux/man-pages/man1/ldd.1.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ldd"),a("OutboundLink")],1),t._v(": run "),a("code",[t._v("ldd /usr/bin/python3.4")]),t._v(" to find static and shared libs.")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://linux.die.net/man/1/readelf",target:"_blank",rel:"noopener noreferrer"}},[t._v("readelf"),a("OutboundLink")],1),t._v(" print out symbols in a .so file.")])]),t._v(" "),a("p",[t._v("Use my BBG device as an example:")]),t._v(" "),a("ul",[a("li",[t._v("python header files are located "),a("code",[t._v("/usr/include/python3.4m/*")]),t._v(" and "),a("code",[t._v("/usr/include/arm-linux-gnueabihf/python3.4m/")])]),t._v(" "),a("li",[t._v("python libs are at "),a("code",[t._v("/usr/lib/python3.4/config-3.4m-arm-linux-gnueabihf/libpython3.4*")]),t._v(", "),a("code",[t._v("/lib/arm-linux-gnueabihf/libz.so.1")]),t._v(" and "),a("code",[t._v("/lib/arm-linux-gnueabihf/libexpat.so.1")]),t._v(".")])]),t._v(" "),a("p",[t._v("I used an NFS directory to share the libs and headers to host. (following commands assume it set up at "),a("code",[t._v("/mnt/remote/")]),t._v(")")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -r /usr/include/python3.4m/* /mnt/remote/python3.4/include\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" /mnt/remote/python3.4/include/arm-linux-gnueabihf/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -r /usr/include/arm-linux-gnueabihf/python3.4m /mnt/remote/python3.4/include/arm-linux-gnueabihf/\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /usr/lib/python3.4/config-3.4m-arm-linux-gnueabihf/libpython3.4* /mnt/remote/python3.4/lib/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /lib/arm-linux-gnueabihf/libz.so.1  /mnt/remote/python3.4/lib/libz.so\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /lib/arm-linux-gnueabihf/libexpat.so.1  /mnt/remote/python3.4/lib/libexpat.so\n")])])]),a("p",[t._v("Set compiler flags:")]),t._v(" "),a("div",{staticClass:"language-Makefile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-makefile"}},[a("code",[t._v("...\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ~/foo/public is the NFS entry on the host")]),t._v("\nIFLAGS"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-I"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HOME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("/foo/public/python3.4/"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("include")]),t._v("\nLFLAGS"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-L"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HOME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("/foo/public/python3.4/lib\n...\n")])])]),a("h2",{attrs:{id:"use-pip-packages"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#use-pip-packages"}},[t._v("#")]),t._v(" Use pip packages")]),t._v(" "),a("p",[t._v("Note that embedded python interpret does not load pip package path by default.\nYou need to call "),a("code",[t._v("PySys_SetPath()")]),t._v(" to manually setup the paths of the python modules you want to access.")]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("#"),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("define")]),t._v('  PY_PACKAGE_PATH L"/usr/local/lib/python3.4/dist-packages"')]),t._v("\n\nwchar_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" wc_default_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Py_GetPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsize_t full_path_len "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wcslen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wc_default_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wcslen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("PY_PACKAGE_PATH"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nwchar_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" wc_whole_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wchar_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("malloc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sizeof")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wchar_t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" full_path_len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wcscpy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wc_whole_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" wc_default_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wcscat")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wc_whole_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" L"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('":"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wcscat")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wc_whole_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" PY_PACKAGE_PATH"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("PySys_SetPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wc_whole_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"be-aware-of-gil"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#be-aware-of-gil"}},[t._v("#")]),t._v(" Be Aware of GIL")]),t._v(" "),a("p",[t._v("Most of the python implementation has a GIL, which can be quite annoying when you are using multi-threads.\nHere is a "),a("a",{attrs:{href:"https://stackoverflow.com/questions/15470367/pyeval-initthreads-in-python-3-how-when-to-call-it-the-saga-continues-ad-naus/15471525#15471525",target:"_blank",rel:"noopener noreferrer"}},[t._v("thread"),a("OutboundLink")],1),t._v(" that may help.")]),t._v(" "),a("h2",{attrs:{id:"reference"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reference"}},[t._v("#")]),t._v(" Reference")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://stackoverflow.com/questions/48703423/cython-compile-a-standalone-static-executable",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://stackoverflow.com/questions/48703423/cython-compile-a-standalone-static-executable"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://stackoverflow.com/questions/34732/how-do-i-list-the-symbols-in-a-so-file",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://stackoverflow.com/questions/34732/how-do-i-list-the-symbols-in-a-so-file"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://stackoverflow.com/questions/15470367/pyeval-initthreads-in-python-3-how-when-to-call-it-the-saga-continues-ad-naus/15471525#15471525",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://stackoverflow.com/questions/15470367/pyeval-initthreads-in-python-3-how-when-to-call-it-the-saga-continues-ad-naus/15471525#15471525"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=s.exports}}]);